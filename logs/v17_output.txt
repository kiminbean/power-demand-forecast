Using device: mps

============================================================
제주시 전력 수요 예측 - RNN 계열 모델
논문: 기상 변수 통합 순환 신경망을 활용한 제주시 전력 수요 예측
목표: R² 75% 달성
============================================================
============================================================
데이터 로드 및 전처리 시작...
============================================================
전력 데이터: 4383행, 2013-01-01 00:00:00 ~ 2024-12-31 00:00:00
기온 데이터: 4717행, 2013-01-01 00:00:00 ~ 2025-11-30 00:00:00
일사량 데이터: 4715행
이슬점 온도 데이터: 4717행
관광객 데이터: 4718행
전기차 데이터: 4353행

병합 후 데이터: 4387행, 10열
결측치 현황:
date              0
power_mwh         0
avg_temp          0
min_temp          0
max_temp          0
sunlight          2
dew_point         0
visitors          9
ev_cumulative    30
ev_daily_new     30
dtype: int64

============================================================
이상치 탐지 및 처리 (IQR 기반 Capping)
============================================================
컬럼              하한 이상치       상한 이상치       총계       하한값          상한값         
---------------------------------------------------------------------------
power_mwh       0            1            1        3054.87      16062.59    
visitors        123          7            130      17771.25     56537.25    

총 131개 이상치를 Capping 처리했습니다.

최종 데이터: 4022행, 62열
기간: 2014-01-01 00:00:00 ~ 2024-12-31 00:00:00

============================================================
피어슨 상관계수 분석
============================================================

전력 수요와 변수 간 상관계수 (상위 20개):
--------------------------------------------------
power_rolling_mean_3               : +0.9599  ★★★
power_rolling_max_3                : +0.9502  ★★★
power_rolling_min_3                : +0.9447  ★★★
power_rolling_mean_7               : +0.9260  ★★★
power_lag_1                        : +0.9215  ★★★
power_rolling_max_7                : +0.9097  ★★★
power_rolling_min_7                : +0.9047  ★★★
power_rolling_mean_14              : +0.8966  ★★★
power_rolling_max_14               : +0.8770  ★★★
power_rolling_mean_21              : +0.8756  ★★★
power_rolling_min_14               : +0.8696  ★★★
power_lag_2                        : +0.8624  ★★★
power_rolling_mean_30              : +0.8532  ★★★
power_rolling_max_21               : +0.8521  ★★★
power_rolling_min_21               : +0.8469  ★★★
power_lag_3                        : +0.8412  ★★★
power_rolling_max_30               : +0.8303  ★★★
power_rolling_min_30               : +0.8241  ★★★
power_lag_7                        : +0.8139  ★★★
power_lag_14                       : +0.7644  ★★★
상관관계 히트맵이 '/Users/ibkim/Ormi_1/power-demand-forecast/results/correlation_heatmap.png'에 저장되었습니다.

고상관 피처 (r >= 0.7): 24개

사용할 피처 (32개):
   1. power_rolling_mean_3           (r=+0.960)
   2. power_rolling_max_3            (r=+0.950)
   3. power_rolling_min_3            (r=+0.945)
   4. power_rolling_mean_7           (r=+0.926)
   5. power_lag_1                    (r=+0.921)
   6. power_rolling_max_7            (r=+0.910)
   7. power_rolling_min_7            (r=+0.905)
   8. power_rolling_mean_14          (r=+0.897)
   9. power_rolling_max_14           (r=+0.877)
  10. power_rolling_min_14           (r=+0.870)
  11. power_lag_2                    (r=+0.862)
  12. power_lag_3                    (r=+0.841)
  13. power_rolling_mean_30          (r=+0.853)
  14. power_rolling_max_30           (r=+0.830)
  15. power_rolling_min_30           (r=+0.824)
  16. power_lag_7                    (r=+0.814)
  17. power_rolling_mean_21          (r=+0.876)
  18. power_rolling_max_21           (r=+0.852)
  19. power_rolling_min_21           (r=+0.847)
  20. year                           (r=+0.732)
  21. power_lag_365                  (r=+0.696)
  22. power_lag_14                   (r=+0.764)
  23. avg_temp                       (r=-0.107)
  24. sunlight                       (r=-0.070)
  25. dew_point                      (r=-0.122)
  26. CDD                            (r=+0.289)
  27. HDD                            (r=+0.268)
  28. month_sin                      (r=+0.085)
  29. month_cos                      (r=+0.107)
  30. dayofweek_sin                  (r=+0.091)
  31. dayofweek_cos                  (r=-0.042)
  32. is_weekend                     (r=-0.112)

============================================================
자동 하이퍼파라미터 튜닝 시작 (목표 R²: 0.75)
============================================================

데이터 분할:
  Train: 3291 샘플 (~2022-12-31)
  Val:   365 샘플
  Test:  366 샘플
  피처 수: 32

============================================================
Iteration 1/15 (Seed: 5678)
Config: hidden=128, layers=1, seq=14, batch=32, lr=0.001
============================================================

  Training BiLSTM...
    BiLSTM: MAE=741.42, RMSE=944.75, R²=0.7090 (70.90%)
    ★ New Best R²: 0.7090 (70.90%)

============================================================
Iteration 2/15 (Seed: 5678)
Config: hidden=128, layers=1, seq=14, batch=32, lr=0.0015
============================================================

  Training BiLSTM...
    BiLSTM: MAE=740.39, RMSE=945.04, R²=0.7088 (70.88%)

============================================================
Iteration 3/15 (Seed: 5678)
Config: hidden=128, layers=1, seq=14, batch=32, lr=0.002
============================================================

  Training BiLSTM...
    BiLSTM: MAE=762.33, RMSE=969.74, R²=0.6934 (69.34%)

============================================================
Iteration 4/15 (Seed: 5678)
Config: hidden=128, layers=1, seq=7, batch=32, lr=0.001
============================================================

  Training BiLSTM...
    BiLSTM: MAE=741.63, RMSE=939.18, R²=0.7094 (70.94%)
    ★ New Best R²: 0.7094 (70.94%)

============================================================
Iteration 5/15 (Seed: 5678)
Config: hidden=128, layers=1, seq=7, batch=32, lr=0.0015
============================================================

  Training BiLSTM...
    BiLSTM: MAE=770.15, RMSE=971.16, R²=0.6893 (68.93%)

============================================================
Iteration 6/15 (Seed: 5678)
Config: hidden=64, layers=1, seq=14, batch=32, lr=0.001
============================================================

  Training BiLSTM...
    BiLSTM: MAE=744.33, RMSE=948.76, R²=0.7065 (70.65%)

============================================================
Iteration 7/15 (Seed: 5678)
Config: hidden=64, layers=1, seq=14, batch=32, lr=0.0015
============================================================

  Training BiLSTM...
    BiLSTM: MAE=744.17, RMSE=945.33, R²=0.7086 (70.86%)

============================================================
Iteration 8/15 (Seed: 5678)
Config: hidden=96, layers=1, seq=14, batch=32, lr=0.001
============================================================

  Training BiLSTM...
    BiLSTM: MAE=736.70, RMSE=936.27, R²=0.7142 (71.42%)
    ★ New Best R²: 0.7142 (71.42%)

============================================================
Iteration 9/15 (Seed: 5678)
Config: hidden=96, layers=1, seq=7, batch=32, lr=0.001
============================================================

  Training BiLSTM...
    BiLSTM: MAE=750.76, RMSE=953.55, R²=0.7004 (70.04%)

============================================================
Iteration 10/15 (Seed: 5678)
Config: hidden=128, layers=1, seq=14, batch=16, lr=0.001
============================================================

  Training BiLSTM...
    BiLSTM: MAE=778.22, RMSE=985.44, R²=0.6834 (68.34%)

============================================================
Iteration 11/15 (Seed: 5678)
Config: hidden=128, layers=1, seq=14, batch=64, lr=0.002
============================================================

  Training BiLSTM...
    BiLSTM: MAE=742.47, RMSE=948.74, R²=0.7065 (70.65%)

============================================================
Iteration 12/15 (Seed: 5678)
Config: hidden=128, layers=1, seq=14, batch=32, lr=0.001
============================================================

  Training BiLSTM...
    BiLSTM: MAE=769.54, RMSE=977.04, R²=0.6888 (68.88%)

============================================================
Iteration 13/15 (Seed: 5678)
Config: hidden=128, layers=1, seq=14, batch=32, lr=0.001
============================================================

  Training BiLSTM...
    BiLSTM: MAE=737.04, RMSE=940.50, R²=0.7116 (71.16%)

============================================================
Iteration 14/15 (Seed: 1234)
Config: hidden=128, layers=1, seq=14, batch=32, lr=0.001
============================================================

  Training BiLSTM...
    BiLSTM: MAE=743.64, RMSE=946.36, R²=0.7080 (70.80%)

============================================================
Iteration 15/15 (Seed: 42)
Config: hidden=128, layers=1, seq=14, batch=32, lr=0.001
============================================================

  Training BiLSTM...
    BiLSTM: MAE=749.18, RMSE=944.92, R²=0.7089 (70.89%)

============================================================
최종 Best R²: 0.7142 (71.42%) - BiLSTM
============================================================

============================================================
앙상블 성능 계산 (3개 모델)
============================================================
  [단순평균] MAE=745.99, RMSE=945.96, R²=0.7052 (70.52%)
    모델 1: R²=0.7094, 가중치=0.338
    모델 2: R²=0.6893, 가중치=0.328
    모델 3: R²=0.7004, 가중치=0.334
  [가중평균] MAE=745.88, RMSE=945.85, R²=0.7053 (70.53%)

  ▶ 최적 앙상블: 가중평균 R²=0.7053 (70.53%)

목표 R² 미달성 - 하이브리드 앙상블 시도...

============================================================
V10: 하이브리드 앙상블 (BiLSTM + Gradient Boosting)
============================================================
Train: 3291, Val: 365, Test: 366

[1] BiLSTM 학습...
  BiLSTM R²: 0.7012 (70.12%)

[2] Gradient Boosting으로 잔차 학습...
  LightGBM 잔차 학습...
  BiLSTM + LightGBM R²: 0.6787 (67.87%)

최종 결과: BiLSTM R²=0.7012 (70.12%)

============================================================
최종 결과
============================================================

최적 모델: BiLSTM

하이퍼파라미터:
  hidden_dim: 96
  num_layers: 1
  seq_length: 14
  batch_size: 32
  lr: 0.001
  dropout: 0.1
  epochs: 800
  seed: 5678
  model: BiLSTM

성능 지표:
  MAE:  736.70 MWh
  MSE:  876593.25
  RMSE: 936.27 MWh
  R²:   0.7142 (71.42%)
  MAPE: 6.41%

============================================================
결과 그래프가 '/Users/ibkim/Ormi_1/power-demand-forecast/results/results.png'에 저장되었습니다.

모델이 '/Users/ibkim/Ormi_1/power-demand-forecast/best_model.pt'에 저장되었습니다.
