#!/usr/bin/env python3
"""
jeju_air_crawler.py 검증 보고서
================================
검증일: 2024-12-15
검증자: Claude + Gemini 크로스체크

결론: ❌ NON-FUNCTIONAL (3개 데이터 소스 모두 동작 불가)
"""

# =============================================================================
# 1. 소스별 검증 결과
# =============================================================================

VERIFICATION_RESULTS = {
    "소스 1: 공공데이터포털 API (PassengerNoticeKR)": {
        "URL": "https://apis.data.go.kr/B551177/PassengerNoticeKR/getfPassengerNoticeIKR",
        "상태": "❌ FAIL",
        "문제점": [
            "이 API는 FIDS(운항정보시스템)용 데이터만 제공",
            "여객 수(passenger count)를 제공하지 않음 - 항공사 영업비밀",
            "코드의 sumPax, line, io 필드는 실제 응답에 존재하지 않음",
            "코드는 '환각(Hallucination)' - 다른 API(인천공항) 명세와 혼용",
        ],
        "실행_결과": "API 호출 성공(200 OK)하더라도 sumPax=0으로 집계됨",
    },
    
    "소스 2: 한국공항공사 웹 (airport.co.kr)": {
        "URL": "https://www.airport.co.kr/www/cms/frFlightStatsCon/passengerStats.do",
        "상태": "❌ FAIL",
        "문제점": [
            "해당 엔드포인트는 더 이상 유효하지 않음",
            "실제 데이터는 항공정보포털(Air Portal)로 리다이렉트",
            "CSRF 토큰 없이 외부 POST 요청 차단됨",
            "403 Forbidden 또는 404 Not Found 발생",
        ],
        "실행_결과": "접근 불가",
    },
    
    "소스 3: 항공정보포털 (airportal.go.kr)": {
        "URL": "https://www.airportal.go.kr/knowledge/statsnew/airport/AirportD.jsp",
        "상태": "⚠️ PARTIAL",
        "문제점": [
            "URL/파라미터가 구버전 (사이트 개편으로 변경됨)",
            "파라미터 'iArport', 'startDt' 등이 더 이상 유효하지 않을 수 있음",
            "복잡한 Form POST 방식으로 크롤링 난이도 높음",
        ],
        "권장_대안": "https://www.airportal.go.kr/life/airinfo/RbHanStatus.jsp (실시간 현황)",
    },
}

# =============================================================================
# 2. 공공데이터포털 여객실적 데이터 확인
# =============================================================================

DATA_GO_KR_FILE_DATA = {
    "파일데이터ID": "15002610",
    "파일명": "한국공항공사_공항별 여객실적_20250922",
    "업데이트_주기": "연간",  # ← 일별 아님!
    "전체_행": 46,  # ← 공항별/노선별 연간 집계
    "형식": "CSV (파일 다운로드)",  # ← API 아님!
    "특징": "연간 집계 데이터로 일별 변환 시 성수기/비수기 변동성 손실",
    "적합성": "❌ 일별 예측 모델에 부적합",
}

# =============================================================================
# 3. Gemini 최종 권장사항
# =============================================================================

GEMINI_RECOMMENDATION = """
[Hybrid Pipeline Strategy]

┌─────────────────────────────────────────────────────────────┐
│  과거 데이터 (2013~2024)                                      │
│  ─────────────────────────                                  │
│  방법: 기존 jeju_daily_visitors_v10.csv 사용                  │
│  근거: 이미 12년치 일별 데이터 보유, 개발 비용 0               │
│  검증: 연간 총합이 항공정보포털 통계와 ±2% 이내인지 확인       │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  미래 데이터 (Daily Update)                                   │
│  ─────────────────────────                                  │
│  방법: 항공정보포털 RbHanStatus.jsp 크롤러                    │
│  URL: https://www.airportal.go.kr/life/airinfo/RbHanStatus.jsp│
│  주기: 매일 아침 전날 확정치 적재                              │
└─────────────────────────────────────────────────────────────┘
"""

# =============================================================================
# 4. 옵션별 평가
# =============================================================================

OPTIONS_EVALUATION = {
    "A. 항공정보포털 크롤링": {
        "데이터_정확도": "High (원천 데이터)",
        "구현_난이도": "High(과거) / Low(실시간)",
        "추천": "부분 추천",
        "평가": "12년치 크롤링은 비효율적(IP차단 위험), Daily Update용으로 사용",
    },
    "B. 한국공항공사 웹 크롤링": {
        "데이터_정확도": "Medium",
        "구현_난이도": "Very High",
        "추천": "❌ 비추천",
        "평가": "JS 렌더링 필요, 보안 장벽 높음, 유지보수 어려움",
    },
    "C. 공공데이터 연간→일별 분배": {
        "데이터_정확도": "FAIL (통계적 오류)",
        "구현_난이도": "Low",
        "추천": "❌ 절대 불가",
        "평가": "성수기/비수기 변동성 손실, 전력 피크 예측에 무가치",
    },
    "D. 기존 CSV 사용": {
        "데이터_정확도": "High",
        "구현_난이도": "Zero",
        "추천": "✅ 강력 추천",
        "평가": "이미 12년치 일별 데이터 보유, 검증 후 바로 사용",
    },
}

# =============================================================================
# 5. 코드 문제점 상세
# =============================================================================

CODE_ISSUES = {
    "_fetch_from_data_go_kr()": {
        "문제": "sumPax 필드가 실제 API 응답에 존재하지 않음",
        "원인": "인천공항공사 API 명세와 혼동된 환각 코드",
        "결과": "항상 0명 반환",
    },
    "_fetch_from_kac_web()": {
        "문제": "URL 엔드포인트 비활성화",
        "원인": "한국공항공사 웹사이트 구조 변경",
        "결과": "403/404 에러 또는 빈 테이블",
    },
    "_fetch_from_airportal()": {
        "문제": "파라미터 이름 및 URL 경로 변경됨",
        "원인": "항공정보포털 사이트 개편",
        "결과": "데이터 파싱 실패",
    },
}

# =============================================================================
# 6. 최종 결론
# =============================================================================

FINAL_CONCLUSION = """
═══════════════════════════════════════════════════════════════════════════════
                        최종 검증 결론
═══════════════════════════════════════════════════════════════════════════════

상태: ❌ jeju_air_crawler.py는 NON-FUNCTIONAL

원인:
  1. 공공데이터포털 API: 여객 수 제공 안함 (운항정보만 제공)
  2. 한국공항공사 웹: URL 비활성화 및 리다이렉트
  3. 항공정보포털: 파라미터/URL 변경으로 파싱 실패

권장 조치:
  1. 기존 크롤러 폐기 (deprecated 폴더로 이동)
  2. 과거 데이터: jeju_daily_visitors_v10.csv 그대로 사용
  3. 미래 데이터: 새로운 Daily Update 크롤러 필요 시 별도 개발

이유:
  - 이미 jeju_daily_visitors_v10.csv (2013-2025, 4,378일)이 검증됨
  - Convolution 방식으로 jeju_daily_population_2013_2024_v2.csv 생성 완료
  - LSTM 학습에 충분한 데이터 확보됨

═══════════════════════════════════════════════════════════════════════════════
"""

if __name__ == "__main__":
    print(FINAL_CONCLUSION)
    
    print("\n[소스별 검증 결과]")
    for source, result in VERIFICATION_RESULTS.items():
        print(f"\n{source}")
        print(f"  상태: {result['상태']}")
        for issue in result.get('문제점', []):
            print(f"  - {issue}")
    
    print("\n[최종 권장사항]")
    print(GEMINI_RECOMMENDATION)
